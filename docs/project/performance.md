## æ€§èƒ½å®šä¹‰

[é“¾æ¥ ğŸ”—ï¼šMDN ä¸Šçš„ Web æ€§èƒ½å®šä¹‰](https://developer.mozilla.org/en-US/docs/Learn/Performance/What_is_web_performance)

Web æ€§èƒ½æ—¶ç½‘ç«™æˆ–åº”ç”¨ç¨‹åºçš„å®¢è§‚åº¦é‡å’Œå¯æ„ŸçŸ¥çš„ç”¨æˆ·ä½“éªŒã€‚

- å‡å°‘æ•´ä½“åŠ è½½æ—¶é—´ï¼šå‡å°æ–‡ä»¶ä½“ç§¯ã€å‡å°‘ HTTP è¯·æ±‚ã€ä½¿ç”¨é¢„åŠ è½½
- ä½¿ç½‘ç«™å°½å¿«å¯ç”¨ï¼šä»…åŠ è½½é¦–å±å†…å®¹ï¼Œå…¶å®ƒå†…å®¹æ ¹æ®éœ€è¦è¿›è¡Œæ‡’åŠ è½½
- å¹³æ»‘å’Œäº¤äº’æ€§ï¼šä½¿ç”¨ CSS æ›¿ä»£ JS åŠ¨ç”»ã€å‡å°‘ UI é‡ç»˜
- æ„ŸçŸ¥è¡¨ç°ï¼šä½ çš„é¡µé¢å¯èƒ½ä¸èƒ½åšçš„æ›´å¿«ï¼Œä½†ä½ å¯ä»¥è®©ç”¨æˆ·æ„Ÿè§‰æ›´å¿«ã€‚è€—æ—¶æ“ä½œè¦ç»™ç”¨æˆ·åé¦ˆï¼Œæ¯”å¦‚åŠ è½½åŠ¨ç”»ã€è¿›åº¦æ¡ã€éª¨æ¶å±ç­‰æç¤ºä¿¡æ¯
- æ€§èƒ½æµ‹å®šï¼šæ€§èƒ½æŒ‡æ ‡ã€æ€§èƒ½æµ‹è¯•ã€æ€§èƒ½ç›‘æ§æŒç»­ä¼˜åŒ–

## å¦‚ä½•è¿›è¡Œ Web æ€§èƒ½ä¼˜åŒ–ï¼Ÿ

- 1.é¦–å…ˆéœ€è¦äº†è§£æ€§èƒ½æŒ‡æ ‡ - å¤šå¿«æ‰ç®—å¿«ï¼Ÿ
- 2.ä½¿ç”¨ä¸“ä¸šçš„å·¥å…·å¯é‡åŒ–çš„è¯„ä¼°å‡ºç½‘ç«™æˆ–åº”ç”¨çš„æ€§èƒ½è¡¨ç°
- 3.ç„¶åç«‹è¶³äºç½‘ç«™é¡µé¢å“åº”çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†æå‡ºé€ æˆè¾ƒå·®æ€§èƒ½è¡¨ç°çš„åŸå› 
- 4.æœ€åè¿›è¡ŒæŠ€æœ¯æ”¹é€ ã€å¯è¡Œæ€§åˆ†æç­‰å…·ä½“çš„ä¼˜åŒ–å®æ–½
- 5.è¿­ä»£ä¼˜åŒ–

## ç”Ÿå‘½å‘¨æœŸ

ç½‘ç«™é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šä¿—åœ°è®²å°±æ˜¯ä»æˆ‘ä»¬åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­è¾“å…¥ä¸€ä¸ª URL åï¼Œåˆ°æ•´ä¸ªé¡µé¢æ¸²æŸ“å‡ºæ¥çš„è¿‡ç¨‹ã€‚æ•´ä¸ªè¿‡ç¨‹åŒ…æ‹¬åŸŸåè§£æï¼Œå»ºç«‹ TCP è¿æ¥ï¼Œå‰åç«¯é€šè¿‡ HTTP è¿›è¡Œä¼šè¯ï¼Œå‹ç¼©ä¸è§£å‹ç¼©ï¼Œä»¥åŠå‰ç«¯çš„å…³é”®æ¸²æŸ“è·¯å¾„ç­‰ï¼ŒæŠŠè¿™äº›é˜¶æ®µæ‹†è§£å¼€æ¥çœ‹ï¼Œä¸ä»…èƒ½å®¹æ˜“åœ°è·å¾—ä¼˜åŒ–æ€§èƒ½çš„å¯å‘ï¼Œè€Œä¸”ä¹Ÿèƒ½ä¸ºä»Šåçš„å‰ç«¯å·¥ç¨‹å¸ˆä¹‹è·¯æ„å»ºå‡ºå®Œæ•´çš„çŸ¥è¯†æ¡†æ¶ï¼Œç½‘ç«™é¡µé¢åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
![](./img/url_entered_process.png)

## ä¼˜åŒ–æ–¹æ¡ˆ

ç»è¿‡å¯¹ç½‘ç«™é¡µé¢æ€§èƒ½çš„æµ‹é‡åŠæ¸²æŸ“è¿‡ç¨‹çš„äº†è§£ï¼Œç›¸ä¿¡ä½ å¯¹äºç³Ÿç³•æ€§èƒ½ä½“éªŒçš„åŸå› å·²ç»æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä¾¿æ˜¯ä¼˜åŒ–æ€§èƒ½ï¼Œè¿™ä¹Ÿæ˜¯æœ¬è¯¾ç¨‹æ‰€è¦å‘ˆç°ç»™è¯»è€…çš„å¤§éƒ¨åˆ†ç¯‡å¹…ã€‚æœ¬èŠ‚å…ˆç®€å•æ‰¼è¦åœ°ä»‹ç»ä¸€äº›ä¼˜åŒ–æ–¹é¢çš„æ€è·¯ã€‚

- ä»å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°å“åº”çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚ DNS æŸ¥è¯¢ã€HTTP é•¿è¿æ¥ã€HTTP 2ã€HTTP å‹ç¼©ã€HTTP ç¼“å­˜ç­‰ã€‚
- å…³é”®æ¸²æŸ“è·¯å¾„ä¼˜åŒ–ï¼Œæ¯”å¦‚æ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„é‡ç»˜å’Œå›æµã€‚
- åŠ è½½è¿‡ç¨‹çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å»¶è¿ŸåŠ è½½ï¼Œæ˜¯å¦æœ‰ä¸éœ€è¦åœ¨é¦–å±å±•ç¤ºçš„éå…³é”®ä¿¡æ¯ï¼Œå ç”¨äº†é¡µé¢åŠ è½½çš„æ—¶é—´ã€‚
- ä¸åŒçš„æ ¼å¼ç±»å‹ä¼šæœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æ˜¯å¦æ°å½“ã€‚
- æ„å»ºä¼˜åŒ–ï¼Œæ¯”å¦‚å‹ç¼©åˆå¹¶ã€åŸºäº webpack æ„å»ºä¼˜åŒ–æ–¹æ¡ˆç­‰ã€‚
- ...

## æ€§èƒ½æŒ‡æ ‡

- [RAIL æ€§èƒ½æ¨¡å‹](https://web.dev/rail/)
- [åŸºäºç”¨æˆ·ä½“éªŒçš„æ ¸å¿ƒæŒ‡æ ‡](https://web.dev/metrics/)
- [æ–°ä¸€ä»£æ€§èƒ½æŒ‡æ ‡ï¼šWeb Vitals](https://web.dev/vitals/)

æˆ‘ä»¬å·²ç»çŸ¥é“æ€§èƒ½çš„é‡è¦æ€§ï¼Œä½†å½“æˆ‘ä»¬è®¨è®ºæ€§èƒ½çš„æ—¶å€™ï¼Œè®©ä¸€ä¸ªç½‘é¡µå˜å¾—è·Ÿå¿«ï¼Œå…·ä½“æ˜¯æŒ‡å“ªäº›ï¼Ÿ
äº‹å®ä¸Šæ€§èƒ½æ˜¯ç›¸å¯¹çš„ï¼š

- å¯¹äºä¸€ä¸ªç”¨æˆ·è€Œè¨€ï¼Œä¸€ä¸ªç«™ç‚¹å¯èƒ½é€Ÿåº¦å¾ˆå¿«ï¼ˆåœ¨å…·æœ‰åŠŸèƒ½å¼ºå¤§çš„è®¾å¤‡çš„å¿«é€Ÿç½‘ç»œä¸Šï¼‰ï¼Œè€Œå¯¹äºå¦ä¸€ç”¨æˆ·è€Œè¨€ï¼Œä¸€ä¸ªç«™ç‚¹å¯èƒ½ä¼šè¾ƒæ…¢ï¼ˆåœ¨å…·æœ‰ä½ç«¯è®¾å¤‡çš„æ…¢é€Ÿç½‘ç»œä¸Šï¼‰ã€‚
- ä¸¤ä¸ªç«™ç‚¹å¯èƒ½ä¼šåœ¨å®Œå…¨ç›¸åŒçš„æ—¶é—´å†…å®ŒæˆåŠ è½½ï¼Œä½†ä¸€ä¸ªç«™ç‚¹ä¼¼ä¹åŠ è½½é€Ÿåº¦ä¼šæ›´å¿«ï¼ˆå¦‚æœå®ƒé€æ­¥åŠ è½½å†…å®¹ï¼Œè€Œä¸æ˜¯ç­‰åˆ°æœ€åæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼‰ã€‚
- ä¸€ä¸ªç½‘ç«™å¯èƒ½ä¼šå‡ºç°å¿«é€ŸåŠ è½½ä½†åæ¥ï¼ˆåœ¨å…¨éƒ¨æˆ–æ²¡æœ‰ï¼‰æ…¢æ…¢åœ°å“åº”ç”¨æˆ·çš„äº¤äº’ã€‚

æ‰€ä»¥åœ¨è®¨è®ºæ€§èƒ½çš„æ—¶å€™ï¼Œç²¾ç¡®çš„ã€å¯é‡åŒ–çš„æŒ‡æ ‡å¾ˆé‡è¦ã€‚

ä½†æ˜¯ï¼Œä»…ä»…å› ä¸ºä¸€ä¸ªåº¦é‡æ ‡å‡†æ˜¯åŸºäºå®¢è§‚æ ‡å‡†å¹¶ä¸”å¯ä»¥å®šé‡åœ°åº¦é‡çš„ï¼Œå¹¶ä¸ä¸€å®šæ„å‘³ç€è¿™äº›åº¦é‡æ˜¯æœ‰ç”¨çš„ã€‚

å¯¹äº Web å¼€å‘äººå‘˜æ¥è¯´ï¼Œå¦‚ä½•è¡¡é‡ä¸€ä¸ª Web é¡µé¢çš„æ€§èƒ½ä¸€ç›´æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚

æœ€åˆï¼Œæˆ‘ä»¬ä½¿ç”¨ Time to First Byteã€DomContentLoaded å’Œ Load è¿™äº›è¡¡é‡æ–‡æ¡£åŠ è½½è¿›åº¦çš„æŒ‡æ ‡ï¼Œä½†å®ƒä»¬ä¸èƒ½ç›´æ¥ååº”ç”¨æˆ·è§†è§‰ä½“éªŒã€‚

ä¸ºäº†èƒ½è¡¡é‡ç”¨æˆ·è§†è§‰ä½“éªŒï¼ŒWeb æ ‡å‡†ä¸­å®šä¹‰äº†ä¸€äº›æ€§èƒ½æŒ‡æ ‡ï¼Œè¿™äº›æ€§èƒ½æŒ‡æ ‡è¢«å„å¤§æµè§ˆå™¨æ ‡å‡†åŒ–å®ç°ï¼Œä¾‹å¦‚ First Paint å’Œ First Contentful Paintã€‚è¿˜æœ‰ä¸€äº›ç”± Web å­µåŒ–å™¨ç¤¾åŒºç»„ï¼ˆWICGï¼‰æå‡ºçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚ Largest Contentful Paint ã€Time to Interactiveã€First Input Delayã€First CPU Idleã€‚å¦å¤–è¿˜æœ‰ Google æå‡ºçš„ First Meaningful Paintã€Speed Indexï¼Œç™¾åº¦æå‡ºçš„ First Screen Paintã€‚

è¿™äº›æŒ‡æ ‡ä¹‹é—´å¹¶ä¸æ˜¯æ¯«æ— å…³è”ï¼Œè€Œæ˜¯åœ¨ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„ç›®æ ‡ä¸­ä¸æ–­æ¼”è¿›å‡ºæ¥çš„ï¼Œæœ‰çš„å·²ç»ä¸å†å»ºè®®ä½¿ç”¨ã€æœ‰çš„è¢«å„ç§æµ‹è¯•å·¥å…·å®ç°ã€æœ‰çš„åˆ™å¯ä»¥ä½œä¸ºé€šç”¨æ ‡å‡†æœ‰å„å¤§æµè§ˆå™¨æä¾›çš„å¯ç”¨äºåœ¨ç”Ÿäº§ç¯å¢ƒæµ‹é‡çš„ APIã€‚

### RAIL æ€§èƒ½æ¨¡å‹

RAIL æ˜¯ Responseï¼ŒAnimationï¼ŒIdle å’Œ Load çš„é¦–å­—æ¯ç¼©å†™ï¼Œæ˜¯ä¸€ç§ç”± Google Chrome å›¢é˜Ÿäº 2015 å¹´æå‡ºçš„æ€§èƒ½æ¨¡å‹ï¼Œç”¨äºæå‡æµè§ˆå™¨å†…çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ã€‚

RAIL æ¨¡å‹çš„ç†å¿µæ˜¯â€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œæœ€ç»ˆç›®æ ‡ä¸æ˜¯è®©æ‚¨çš„ç½‘ç«™åœ¨ä»»ä½•ç‰¹å®šè®¾å¤‡ä¸Šéƒ½èƒ½è¿è¡Œå¾ˆå¿«ï¼Œè€Œæ˜¯ä½¿ç”¨æˆ·æ»¡æ„â€ã€‚

![](./img/RAIL_idea.png)

è¿™ä¸ªåå­—çš„ç”±æ¥æ˜¯å››ä¸ªè‹±æ–‡å•è¯çš„é¦–å­—æ¯ï¼š

- å“åº”ï¼ˆResponseï¼‰ï¼šåº”è¯¥å°½å¯èƒ½å¿«é€Ÿçš„å“åº”ç”¨æˆ·, åº”è¯¥åœ¨ 100ms ä»¥å†…å“åº”ç”¨æˆ·è¾“å…¥ã€‚
- åŠ¨ç”»ï¼ˆAnimationï¼‰ï¼šåœ¨å±•ç¤ºåŠ¨ç”»çš„æ—¶å€™ï¼Œæ¯ä¸€å¸§åº”è¯¥ä»¥ 16ms è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ ·å¯ä»¥ä¿æŒåŠ¨ç”»æ•ˆæœçš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”é¿å…å¡é¡¿ã€‚
- ç©ºé—²ï¼ˆIdleï¼‰ï¼šå½“ä½¿ç”¨ Javascript ä¸»çº¿ç¨‹çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠä»»åŠ¡åˆ’åˆ†åˆ°æ‰§è¡Œæ—¶é—´å°äº 50ms çš„ç‰‡æ®µä¸­å»ï¼Œè¿™æ ·å¯ä»¥é‡Šæ”¾çº¿ç¨‹ä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚
- åŠ è½½ï¼ˆLoadï¼‰ï¼šåº”è¯¥åœ¨å°äº 1s çš„æ—¶é—´å†…åŠ è½½å®Œæˆä½ çš„ç½‘ç«™ï¼Œå¹¶å¯ä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚

> æ ¹æ®ç½‘ç»œæ¡ä»¶å’Œç¡¬ä»¶çš„ä¸åŒï¼Œç”¨æˆ·å¯¹æ€§èƒ½å»¶è¿Ÿçš„ç†è§£ä¹Ÿæœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å¿«é€Ÿçš„ Wi-Fi è¿æ¥åœ¨åŠŸèƒ½å¼ºå¤§çš„å°å¼æœºä¸ŠåŠ è½½ç«™ç‚¹é€šå¸¸åœ¨ 1 ç§’å†…å®Œæˆï¼Œç”¨æˆ·å¯¹æ­¤å·²ç»ä¹ ä»¥ä¸ºå¸¸ã€‚åœ¨ 3G è¿æ¥é€Ÿåº¦è¾ƒæ…¢çš„ç§»åŠ¨è®¾å¤‡ä¸ŠåŠ è½½ç½‘ç«™éœ€è¦èŠ±è´¹æ›´å¤šæ—¶é—´ï¼Œå› æ­¤ç§»åŠ¨ç”¨æˆ·é€šå¸¸æ›´è€å¿ƒï¼Œåœ¨ç§»åŠ¨è®¾å¤‡ä¸ŠåŠ è½½ 5 s æ˜¯ä¸€ä¸ªæ›´ç°å®çš„ç›®æ ‡ã€‚

è¿™å››ä¸ªå•è¯ä»£è¡¨ä¸ç½‘ç«™æˆ–åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å››ä¸ªæ–¹é¢ï¼Œè¿™äº›æ–¹é¢ä¼šä»¥ä¸åŒçš„æ–¹å¼å½±å“æ•´ä¸ªç½‘ç«™çš„æ€§èƒ½ã€‚
æˆ‘ä»¬å°†ç”¨æˆ·ä½œä¸ºä¹‹åæ€§èƒ½ä¼˜åŒ–çš„ä¸­å¿ƒï¼Œé¦–å…ˆéœ€è¦äº†è§£ç”¨æˆ·å¯¹äºå»¶è¿Ÿçš„ååº”ã€‚ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿçš„æ—¶é—´çª—å£ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

| å»¶è¿Ÿ         | ç”¨æˆ·åæ˜                                                                                                              |
| ------------ | -------------------------------------------------------------------------------------------------------------------- |
| 0 ~ 16ms     | äººçœ¼å¯ä»¥æ„ŸçŸ¥æ¯ç§’ 60 å¸§çš„åŠ¨ç”»ï¼Œå³æ¯å¸§ 16 msï¼Œé™¤äº†æµè§ˆå™¨å°†ä¸€å¸§ç”»é¢ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„æ—¶é—´ï¼Œç½‘ç«™åº”ç”¨å¤§çº¦éœ€è¦ 10ms æ¥ç”Ÿæˆä¸€å¸§ |
| 0 ~ 100ms    | åœ¨è¯¥æ—¶é—´èŒƒå›´å†…å“åº”ç”¨æˆ·æ“ä½œï¼Œæ‰ä¼šæ˜¯æµç•…çš„ä½“éªŒ                                                                         |
| 100 ~ 1000ms | èƒ½å¤Ÿæ„Ÿè§‰åˆ°æ˜æ˜¾çš„å»¶è¿Ÿ                                                                                                 |
| >1s          | ç”¨æˆ·çš„æ³¨æ„åŠ›å°†ç¦»å¼€å¯¹æ‰§è¡Œä»»åŠ¡çš„å…³æ³¨                                                                                   |
| >10s         | ç”¨æˆ·æ„Ÿåˆ°å¤±æœ›ï¼Œå¯èƒ½ä¼šæ”¾å¼ƒä»»åŠ¡                                                                                         |

#### 1.RAIL æ€§èƒ½æ¨¡å‹ - Response

æŒ‡æ ‡ï¼šåº”è¯¥å°½å¯èƒ½å¿«é€Ÿçš„å“åº”ç”¨æˆ·ï¼Œåº”è¯¥åœ¨ 100ms ä»¥å†…å“åº”ç”¨æˆ·è¾“å…¥ã€‚
ç½‘ç«™æ€§èƒ½å¯¹äºå“åº”æ–¹é¢çš„è¦æ±‚æ˜¯ï¼Œåœ¨ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿä¹‹å‰æ¥æ”¶åˆ°æ“ä½œçš„åé¦ˆã€‚æ¯”å¦‚ç”¨æˆ·è¿›è¡Œäº†æ–‡æœ¬è¾“å…¥ã€æŒ‰é’®å•å‡»ã€è¡¨å•åˆ‡æ¢åŠå¯åŠ¨åŠ¨ç”»ç­‰æ“ä½œåï¼Œå¿…é¡»åœ¨ 100ms å†…æ”¶åˆ°åé¦ˆï¼Œå¦‚æœè¶…è¿‡ 100ms çš„æ—¶é—´çª—å£ï¼Œç”¨æˆ·å°±ä¼šæ„ŸçŸ¥å»¶è¿Ÿã€‚

çœ‹ä¼¼å¾ˆåŸºæœ¬çš„ç”¨æˆ·æ“ä½œèƒŒåï¼Œå¯èƒ½ä¼šéšè—ç€å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¤„ç†åŠç½‘ç»œè¯·æ±‚ä¸æ•°æ®è®¡ç®—ã€‚å¯¹æ­¤æˆ‘ä»¬åº”å½“è°¨æ…ï¼Œå°†è¾ƒå¤§å¼€é”€çš„å·¥ä½œæ”¾åœ¨åå°å¼‚æ­¥æ‰§è¡Œï¼Œè€Œå³ä¾¿åå°å¤„ç†è¦æ•°ç™¾æ¯«ç§’æ‰èƒ½å®Œæˆçš„æ“ä½œï¼Œä¹Ÿåº”å½“ç»™ç”¨æˆ·æä¾›åŠæ—¶çš„é˜¶æ®µæ€§åé¦ˆã€‚

æ¯”å¦‚åœ¨å•å‡»æŒ‰é’®å‘åå°å‘èµ·æŸé¡¹ä¸šåŠ¡å¤„ç†è¯·æ±‚æ—¶ï¼Œé¦–å…ˆåé¦ˆç»™ç”¨æˆ·å¼€å§‹å¤„ç†çš„æç¤ºï¼Œç„¶ååœ¨å¤„ç†å®Œæˆçš„å›è°ƒååé¦ˆå®Œæˆçš„æç¤ºã€‚
![](./img/rail_response.png)

#### 2.RAIL æ€§èƒ½æ¨¡å‹ - Animation

æŒ‡æ ‡ï¼šåœ¨å±•ç¤ºåŠ¨ç”»çš„æ—¶å€™ï¼Œæ¯ä¸€å¸§åº”è¯¥ä»¥ 10ms è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ ·å¯ä»¥ä¿æŒåŠ¨ç”»æ•ˆæœçš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”é¿å…å¡é¡¿ã€‚

å‰ç«¯æ‰€æ¶‰åŠçš„åŠ¨ç”»ä¸ä»…æœ‰ç‚«é…·çš„ UI ç‰¹æ•ˆï¼Œè¿˜åŒ…æ‹¬æ»šåŠ¨å’Œè§¦æ‘¸æ‹–åŠ¨ç­‰äº¤äº’æ•ˆæœï¼Œè€Œè¿™ä¸€æ–¹é¢çš„æ€§èƒ½è¦æ±‚å°±æ˜¯æµç•…ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œäººçœ¼å…·æœ‰è§†è§‰æš‚ç•™ç‰¹æ€§ï¼Œå°±æ˜¯å½“å…‰å¯¹è§†ç½‘è†œæ‰€äº§ç”Ÿçš„è§†è§‰åœ¨å…‰åœæ­¢ä½œç”¨åï¼Œä»èƒ½ä¿ç•™ä¸€æ®µæ—¶é—´ã€‚

ç ”ç©¶è¡¨æ˜è¿™æ˜¯ç”±äºè§†ç¥ç»å­˜åœ¨ååº”é€Ÿåº¦é€ æˆçš„ï¼Œå…¶å€¼æ˜¯ 1/24sï¼Œå³å½“æˆ‘ä»¬æ‰€è§çš„ç‰©ä½“ç§»é™¤åï¼Œè¯¥ç‰©ä½“åœ¨æˆ‘ä»¬çœ¼ä¸­å¹¶ä¸ä¼šç«‹å³æ¶ˆå¤±ï¼Œè€Œä¼šå»¶ç»­å­˜åœ¨ 1/24s çš„æ—¶é—´ã€‚å¯¹åŠ¨ç”»æ¥è¯´ï¼Œæ— è®ºåŠ¨ç”»å¸§ç‡æœ‰å¤šé«˜ï¼Œæœ€åæˆ‘ä»¬ä»…èƒ½åˆ†è¾¨å…¶ä¸­çš„ 30 å¸§ï¼Œä½†è¶Šé«˜çš„å¸§ç‡ä¼šå¸¦æ¥æ›´å¥½çš„æµç•…ä½“éªŒï¼Œå› æ­¤åŠ¨ç”»è¦å°½åŠ›è¾¾åˆ° 60fps çš„å¸§ç‡ã€‚

ç›®å‰å¤§å¤šæ•°è®¾å¤‡çš„å±å¹•åˆ·æ–°ç‡ä¸º 60 æ¬¡/ç§’ï¼Œé‚£ä¹ˆæµè§ˆå™¨æ¸²æŸ“åŠ¨ç”»æˆ–é¡µé¢çš„æ¯ä¸€å¸§çš„é€Ÿç‡ä¹Ÿéœ€è¦è·Ÿè®¾å¤‡å±å¹•çš„åˆ·æ–°ç‡ä¿æŒä¸€è‡´ã€‚æ‰€ä»¥æ ¹æ® 60fps å¸§ç‡çš„è®¡ç®—ï¼Œæ¯ä¸€å¸§ç”»é¢çš„ç”Ÿæˆéƒ½éœ€è¦ç»è¿‡è‹¥å¹²æ­¥éª¤ï¼Œä¸€å¸§å›¾åƒçš„ç”Ÿæˆé¢„ç®—ä¸º 16msï¼ˆ1000ms / 60 â‰ˆ 16.66msï¼‰ï¼Œé™¤å»æµè§ˆå™¨ç»˜åˆ¶æ–°å¸§çš„æ—¶é—´ï¼Œç•™ç»™æ‰§è¡Œä»£ç çš„æ—¶é—´ä»… 10ms å·¦å³ã€‚å¦‚æœæ— æ³•ç¬¦åˆæ­¤é¢„ç®—ï¼Œå¸§ç‡å°†ä¸‹é™ï¼Œå¹¶ä¸”å†…å®¹ä¼šåœ¨å±å¹•ä¸ŠæŠ–åŠ¨ã€‚ æ­¤ç°è±¡é€šå¸¸ç§°ä¸ºå¡é¡¿ï¼Œä¼šå¯¹ç”¨æˆ·ä½“éªŒäº§ç”Ÿè´Ÿé¢å½±å“ã€‚å…³äºè¿™ä¸ªç»´åº¦çš„å…·ä½“ä¼˜åŒ–ç­–ç•¥ï¼Œä¼šåœ¨åé¢ä¼˜åŒ–æ¸²æŸ“è¿‡ç¨‹çš„ç›¸å…³ç« èŠ‚ä¸­è¯¦ç»†ä»‹ç»ã€‚

- https://googlechrome.github.io/devtools-samples/jank/

#### 3.RAIL æ€§èƒ½æ¨¡å‹ - Idle

æŒ‡æ ‡ï¼šå½“ä½¿ç”¨ Javascript ä¸»çº¿ç¨‹çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠä»»åŠ¡åˆ’åˆ†åˆ°æ‰§è¡Œæ—¶é—´å°äº 50ms çš„ç‰‡æ®µä¸­å»ï¼Œè¿™æ ·å¯ä»¥é‡Šæ”¾çº¿ç¨‹ä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚  
è¦ä½¿ç½‘ç«™å“åº”è¿…é€Ÿã€åŠ¨ç”»æµç•…ï¼Œé€šå¸¸éƒ½éœ€è¦è¾ƒé•¿çš„å¤„ç†æ—¶é—´ï¼Œä½†ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒæ¥çœ‹å¾…æ€§èƒ½é—®é¢˜ï¼Œå°±ä¼šå‘ç°å¹¶éæ‰€æœ‰å·¥ä½œéƒ½éœ€è¦åœ¨å“åº”å’ŒåŠ è½½é˜¶æ®µå®Œæˆï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨æµè§ˆå™¨çš„ç©ºé—²æ—¶é—´å¤„ç†å¯å»¶è¿Ÿçš„ä»»åŠ¡ï¼Œåªè¦è®©ç”¨æˆ·æ„Ÿå—ä¸åˆ°å»¶è¿Ÿå³å¯ã€‚åˆ©ç”¨ç©ºé—²æ—¶é—´å¤„ç†å»¶è¿Ÿï¼Œå¯å‡å°‘é¢„åŠ è½½çš„æ•°æ®å¤§å°ï¼Œä»¥ä¿è¯ç½‘ç«™æˆ–åº”ç”¨å¿«é€Ÿå®ŒæˆåŠ è½½ã€‚  
ä¸ºäº†æ›´åŠ åˆç†åœ°åˆ©ç”¨æµè§ˆå™¨çš„ç©ºé—²æ—¶é—´ï¼Œæœ€å¥½å°†å¤„ç†ä»»åŠ¡æŒ‰ 50ms ä¸ºå•ä½åˆ†ç»„ã€‚è¿™ä¹ˆåšå°±æ˜¯ä¿è¯ç”¨æˆ·åœ¨å‘ç”Ÿæ“ä½œåçš„ 100ms å†…ç»™å‡ºå“åº”ã€‚

#### 4.RAIL æ€§èƒ½æ¨¡å‹ - Load

æŒ‡æ ‡ï¼šé¦–æ¬¡åŠ è½½åº”è¯¥åœ¨å°äº 5s çš„æ—¶é—´å†…åŠ è½½å®Œæˆï¼Œå¹¶å¯ä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚å¯¹äºåç»­åŠ è½½ï¼Œåˆ™æ˜¯å»ºè®®åœ¨ 2 ç§’å†…å®Œæˆã€‚

ç”¨æˆ·æ„ŸçŸ¥è¦æ±‚æˆ‘ä»¬å°½é‡åœ¨ 5s å†…å®Œæˆé¡µé¢åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰å®Œæˆï¼Œç”¨æˆ·çš„æ³¨æ„åŠ›å°±ä¼šåˆ†æ•£åˆ°å…¶ä»–äº‹æƒ…ä¸Šï¼Œå¹¶å¯¹å½“å‰å¤„ç†çš„ä»»åŠ¡äº§ç”Ÿä¸­æ–­æ„Ÿã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåœ¨ 5s å†…å®ŒæˆåŠ è½½å¹¶æ¸²æŸ“å‡ºé¡µé¢çš„è¦æ±‚ï¼Œå¹¶éè¦å®Œæˆæ‰€æœ‰é¡µé¢èµ„æºçš„åŠ è½½ï¼Œä»ç”¨æˆ·æ„ŸçŸ¥ä½“éªŒçš„è§’åº¦æ¥è¯´ï¼Œåªè¦å…³é”®æ¸²æŸ“è·¯å¾„å®Œæˆï¼Œç”¨æˆ·å°±ä¼šè®¤ä¸ºå…¨éƒ¨åŠ è½½å·²å®Œæˆã€‚

å¯¹äºå…¶ä»–éå…³é”®èµ„æºçš„åŠ è½½ï¼Œå»¶è¿Ÿåˆ°æµè§ˆå™¨ç©ºé—²æ—¶æ®µå†è¿›è¡Œï¼Œæ˜¯æ¯”è¾ƒå¸¸è§çš„æ¸è¿›å¼ä¼˜åŒ–ç­–ç•¥ã€‚æ¯”å¦‚å›¾ç‰‡æ‡’åŠ è½½ã€ä»£ç æ‹†åˆ†ç­‰ä¼˜åŒ–æ‰‹æ®µã€‚

å…³äºåŠ è½½æ–¹é¢å…·ä½“çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œåç»­ä¹Ÿä¼šåˆ†å‡ºç‹¬ç«‹å†…å®¹è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚

## åŸºäºç”¨æˆ·ä½“éªŒçš„æ€§èƒ½æŒ‡æ ‡

[åŸºäºç”¨æˆ·ä½“éªŒçš„æ€§èƒ½æŒ‡æ ‡](https://web.dev/metrics/)æ˜¯ Google åœ¨ web.dev æå‡ºçš„ã€‚

### 1.[First Contentful Paint é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP)](https://web.dev/fcp/)

FCPï¼ˆFirst Contentful Paintï¼‰é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼Œæµè§ˆå™¨é¦–æ¬¡ç»˜åˆ¶æ¥è‡ª DOM çš„å†…å®¹çš„æ—¶é—´ï¼Œå†…å®¹å¿…é¡»æ˜¯æ–‡æœ¬ã€å›¾ç‰‡ï¼ˆåŒ…å«èƒŒæ™¯å›¾ï¼‰ã€éç™½è‰²çš„ canvas æˆ– SVGï¼Œä¹ŸåŒ…æ‹¬å¸¦æœ‰æ­£åœ¨åŠ è½½ä¸­çš„ Web å­—ä½“çš„æ–‡æœ¬ã€‚

![](./img/fcp_example1.png)

è¿™æ˜¯ç”¨æˆ·ç¬¬ä¸€æ¬¡å¼€å§‹çœ‹åˆ°é¡µé¢å†…å®¹ï¼Œä½†ä»…ä»…æœ‰å†…å®¹ï¼Œå¹¶ä¸æ„å‘³ç€å®ƒæ˜¯æœ‰ç”¨çš„å†…å®¹ï¼ˆä¾‹å¦‚ Headerã€å¯¼èˆªæ ç­‰ï¼‰ï¼Œä¹Ÿä¸æ„å‘³ç€æœ‰ç”¨æˆ·è¦æ¶ˆè´¹çš„å†…å®¹ã€‚

é€Ÿåº¦æŒ‡æ ‡ï¼š
![](./img/fcp_speed_index.png)

ä¼˜åŒ–æ–¹æ¡ˆï¼š

- https://web.dev/fcp/#how-to-improve-fcp

### 2.[Largest Contentful Paintï¼ˆLCPï¼‰](https://web.dev/lcp/)

LCPï¼ˆLargest Contentful Paintï¼‰æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼Œå¯è§†åŒºåŸŸä¸­æœ€å¤§çš„å†…å®¹å…ƒç´ å‘ˆç°åˆ°å±å¹•ä¸Šçš„æ—¶é—´ï¼Œç”¨ä»¥ä¼°ç®—é¡µé¢çš„ä¸»è¦å†…å®¹å¯¹ç”¨æˆ·å¯è§æ—¶é—´ã€‚

LCP è€ƒè™‘çš„å…ƒç´ ï¼š

- img å…ƒç´ 
- image å…ƒç´ å†…çš„ svg å…ƒç´ 
- video å…ƒç´ ï¼ˆå°é¢å›¾ï¼‰
- é€šè¿‡ url()å‡½æ•°åŠ è½½èƒŒæ™¯å›¾ç‰‡çš„å…ƒç´ 
- åŒ…å«æ–‡æœ¬èŠ‚ç‚¹æˆ–å…¶å®ƒå†…è”çº§æ–‡æœ¬å…ƒç´ å­çº§çš„å—çº§å…ƒç´ 

ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç½‘ç«™åº”åŠ›äº‰ä½¿ç”¨ 2.5 ç§’æˆ–æ›´çŸ­çš„â€œæœ€å¤§å†…å®¹ç»˜ç”»â€ ã€‚ä¸ºç¡®ä¿æ‚¨è¾¾åˆ°å¤§å¤šæ•°ç”¨æˆ·çš„è¿™ä¸€ç›®æ ‡ï¼Œè¡¡é‡ç§»åŠ¨è®¾å¤‡å’Œå°å¼æœºè®¾å¤‡çš„é¡µé¢åŠ è½½é‡çš„ç¬¬ 75 ä¸ªç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¡é‡æ ‡å‡†ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š
![](./img/lcp_example1.png)
![](./img/lcp_example2.png)

åœ¨ä»¥ä¸Šä¸¤ä¸ªæ—¶é—´è½´ä¸­ï¼Œæœ€å¤§çš„å…ƒç´ éšå†…å®¹åŠ è½½è€Œå˜åŒ–ã€‚åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæ–°å†…å®¹è¢«æ·»åŠ åˆ° DOM ä¸­ï¼Œå¹¶ä¸”æ›´æ”¹äº†æœ€å¤§çš„å…ƒç´ ã€‚åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œå¸ƒå±€å‘ç”Ÿæ›´æ”¹ï¼Œä»¥å‰æœ€å¤§çš„å†…å®¹ä»è§†å£ä¸­åˆ é™¤ã€‚

é€šå¸¸æƒ…å†µä¸‹ï¼Œå»¶è¿ŸåŠ è½½çš„å†…å®¹è¦æ¯”é¡µé¢ä¸Šå·²æœ‰çš„å†…å®¹å¤§ï¼Œä½†ä¸ä¸€å®šæ˜¯è¿™ç§æƒ…å†µã€‚æ¥ä¸‹æ¥çš„ä¸¤ä¸ªç¤ºä¾‹æ˜¾ç¤ºäº†åœ¨é¡µé¢å®Œå…¨åŠ è½½ä¹‹å‰å‘ç”Ÿçš„æœ€å¤§å†…å®¹ç»˜ç”»ã€‚
![](./img/lcp_example3.png)
![](./img/lcp_example4.png)

åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼ŒInstagram å¾½æ ‡ç›¸å¯¹è¾ƒæ—©åœ°åŠ è½½ï¼Œå³ä½¿é€æ¸æ˜¾ç¤ºå…¶ä»–å†…å®¹ï¼Œå®ƒä»ç„¶æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚åœ¨ Google æœç´¢ç»“æœé¡µé¢ç¤ºä¾‹ä¸­ï¼Œæœ€å¤§çš„å…ƒç´ æ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œè¯¥æ–‡æœ¬åœ¨ä»»ä½•å›¾åƒæˆ–å¾½æ ‡åŠ è½½å®Œæˆä¹‹å‰æ˜¾ç¤ºã€‚ç”±äºæ‰€æœ‰å•ä¸ªå›¾åƒå‡å°äºæ­¤æ®µï¼Œå› æ­¤åœ¨æ•´ä¸ªåŠ è½½è¿‡ç¨‹ä¸­ï¼Œå®ƒå§‹ç»ˆæ˜¯æœ€å¤§çš„å…ƒç´ ã€‚

> åœ¨ Instagram æ—¶é—´è½´çš„ç¬¬ä¸€å¸§ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ç›¸æœºå¾½æ ‡å‘¨å›´æ²¡æœ‰ç»¿è‰²æ¡†ã€‚é‚£æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ª svg å…ƒç´ ï¼Œå¹¶ä¸” svg å…ƒç´ å½“å‰ä¸è¢«è§†ä¸º LCP å€™é€‰å¯¹è±¡ã€‚

é€Ÿåº¦æŒ‡æ ‡ï¼š
![](./img/lcp_speed_index.png)
ä¼˜åŒ–æ–¹æ¡ˆï¼š

- https://web.dev/optimize-lcp/

ã€‚ã€‚ã€‚

## Web Vitals

Google å¼€å‘äº†è®¸å¤šå®ç”¨æŒ‡æ ‡å’Œå·¥å…·ï¼Œå¸®åŠ©è¡¡é‡ç”¨æˆ·ä½“éªŒå’Œè´¨é‡ï¼Œä»è€Œå‘æ˜ä¼˜åŒ–ç‚¹ã€‚ä¸€é¡¹åä¸º Web Vitals çš„è®¡åˆ’é™ä½äº†å­¦ä¹ æˆæœ¬ï¼Œä¸ºç½‘ç«™ä½“éªŒæä¾›äº†ä¸€ç»„ç»Ÿä¸€çš„è´¨é‡è¡¡é‡æŒ‡æ ‡ â€” Core Web Vitalsï¼Œå…¶ä¸­åŒ…æ‹¬åŠ è½½ä½“éªŒã€äº¤äº’æ€§å’Œé¡µé¢å†…å®¹çš„è§†è§‰ç¨³å®šæ€§ã€‚

æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ä¼˜åŒ–ç½‘ç«™çš„ç”¨æˆ·ä½“éªŒã€‚è‹¥èƒ½é¢„å…ˆäº†è§£æœ€ä½³çš„ä¼˜åŒ–è¡¡é‡æ–¹æ³•ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœæ—¶é—´å’Œæˆæœ¬ã€‚

Google åœ¨ 2020 å¹´ 5 æœˆ 5 æ—¥æå‡ºäº†æ–°çš„ç”¨æˆ·ä½“éªŒé‡åŒ–æ–¹å¼ Web Vitals æ¥è¡¡é‡ç½‘ç«™çš„ç”¨æˆ·ä½“éªŒï¼Œå¹¶å°†è¿™äº›è¡¡é‡ç»“æœç”¨ä½œå…¶æ’åç®—æ³•çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£è¿™äº›å†…å®¹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›é‡è¦æŒ‡æ ‡æ˜¯ä»€ä¹ˆã€‚

### Core Web Vitals ä¸ Web Vitals

ä»€ä¹ˆæ˜¯ Web Vitalsï¼ŒGoogle ç»™å‡ºçš„å®šä¹‰æ˜¯ ä¸€ä¸ªè‰¯å¥½ç½‘ç«™çš„åŸºæœ¬æŒ‡æ ‡ï¼ˆEssential metrics for a healthy siteï¼‰ï¼Œè¿‡å»è¦è¡¡é‡ä¸€ä¸ªç½‘ç«™çš„å¥½åï¼Œéœ€è¦ä½¿ç”¨çš„æŒ‡æ ‡å¤ªå¤šäº†ï¼ŒWeb Vitals å¯ä»¥ç®€åŒ–æŒ‡æ ‡çš„å­¦ä¹ æ›²çº¿ï¼Œåªéœ€èšç„¦äº Web Vitals æŒ‡æ ‡çš„è¡¨ç°å³å¯ã€‚

åœ¨è¿™äº› Web Vitals ä¸­ï¼ŒGoogle ç¡®å®šäº†ä¸‰ä¸ªä¸»è¦è¡¡é‡æŒ‡æ ‡ï¼Œå³åœ¨æ‰€æœ‰ç±»å‹çš„ç½‘ç«™ä¸­é€šç”¨çš„ Core Web Vitalsï¼š
![](./img/web_vitals.png)

> Core Web Vitals æ˜¯åº”ç”¨äºæ‰€æœ‰ Web é¡µé¢çš„ Web Vitals çš„å­é›†ï¼Œæ˜¯å…¶æœ€é‡è¦çš„æ ¸å¿ƒã€‚

![](./img/web_vitals_idea.png)

- åŠ è½½æ€§èƒ½ï¼ˆLCPï¼‰ â€” æ˜¾ç¤ºæœ€å¤§å†…å®¹å…ƒç´ æ‰€éœ€æ—¶é—´
- äº¤äº’æ€§ï¼ˆFIDï¼‰ â€” é¦–æ¬¡è¾“å…¥å»¶è¿Ÿæ—¶é—´
- è§†è§‰ç¨³å®šæ€§ï¼ˆCLSï¼‰ â€” ç´¯ç§¯å¸ƒå±€é…ç½®åç§»

è¿™ä¸‰ä¸ªæŒ‡æ ‡å·²ç»ç»è¿‡äº†ä¸€æ®µæ—¶é—´çš„éªŒè¯ï¼Œå¦‚ LCP åœ¨ WICG å·²ç»å­µåŒ–è‡³å°‘ 1 å¹´ä»¥ä¸Šï¼ŒFID åœ¨ Google Chrome Labs ä¸Šå·²ç»å®æ–½ 2 å¹´ä»¥ä¸Šï¼ŒLCP å’Œ CLSï¼ˆç›¸å…³ Layout Instability APIï¼‰å·²äºä»Šå¹´å…¥ W3C è‰æ‹Ÿæ ‡å‡†ã€‚

### æµ‹é‡ Web Vitals

- æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚ Lighthouse
- ä½¿ç”¨ [web-vitals](https://github.com/GoogleChrome/web-vitals)åº“
- ä½¿ç”¨æµè§ˆå™¨æ’ä»¶ Web Vitals

![](./img/web_vitals_plugin_use.png)

### ä¼˜åŒ– Web Vitals

- [Optimize Largest Contentful Paint](https://web.dev/optimize-lcp/)
- [Optimize First Input Delay](https://web.dev/optimize-fid/)
- [Optimize Cumulative Layout Shift](https://web.dev/optimize-cls/)

å‚è€ƒé“¾æ¥ï¼š

- https://web.dev/vitals/
- https://juejin.cn/post/6844904168591736846
- https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma/related
- https://www.uisdc.com/web-vitals

## å…¶ä»–æ€§èƒ½æŒ‡æ ‡

ç•¥

## ç›¸å…³é“¾æ¥

[è¯¾ç¨‹èµ„æ–™](https://www.yuque.com/books/share/bee30889-85b8-442e-be5c-6c683f783e2f/xgqh7t) å¯†ç ï¼šxa3i
